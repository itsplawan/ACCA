<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Pages PDF Viewer</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.15.349/pdf.min.js"></script> <!-- PDF.js -->
    <!-- Link to the external JS file -->
    <script src="/assets/js/script.js"></script>

  </head>
  <body>
    <header>
      <h1>GitHub Pages PDF Viewer</h1>
      <p>Automatically display PDFs and directories from GitHub repo</p>
      <p><a href="https://github.com/itsplawan/ACCA">View Project on GitHub</a></p>
    </header>

    <section>
      <h2>PDFs Available:</h2>
      <ul id="file-list">Loading PDFs...</ul>
      
      <h2>PDF Viewer:</h2>
      <div id="pdf-viewer" style="width:100%; height:600px;">
        <canvas id="pdf-canvas"></canvas> <!-- Canvas for rendering PDF -->
      </div>
      <!-- Navigation Controls -->
      <div id="navigation">
        <button id="prev-page" onclick="changePage(-1)">Previous</button>
        <button id="next-page" onclick="changePage(1)">Next</button>
        <span id="page-num">Page: 1</span>
      </div>
    </section>

    <footer>
      <p>This project is maintained by <a href="https://github.com/itsplawan">itsplawan</a></p>
    </footer>

    <script>
      const repoOwner = "itsplawan";
      const repoName = "ACCA";
      const pdfFolder = "pdfs"; // Folder where PDFs are stored
      let currentPdf = null; // To keep track of the current PDF
      let currentPage = 1; // Current page number
      let totalPages = 0; // Total number of pages

      async function fetchRepoContents() {
        const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${pdfFolder}`;
        const response = await fetch(apiUrl);
        const data = await response.json();
        const fileList = document.getElementById("file-list");

        fileList.innerHTML = "";
        data.forEach(item => {
          if (item.type === "file" && item.name.endsWith(".pdf")) {
            const listItem = document.createElement("li");
            const link = document.createElement("a");
            link.href = "#";
            link.textContent = item.name;
            link.onclick = () => openPdf(item.download_url);
            listItem.appendChild(link);
            fileList.appendChild(listItem);
          }
        });
      }

      // Function to open and render PDF in PDF.js
      function openPdf(url) {
        const canvas = document.getElementById("pdf-canvas");
        const context = canvas.getContext("2d");

        // Fetch the PDF document
        pdfjsLib.getDocument(url).promise.then(pdf => {
          currentPdf = pdf;
          totalPages = pdf.numPages;
          currentPage = 1; // Reset to first page

          renderPage(currentPage);
        }).catch(error => {
          console.error('Error loading PDF:', error);
        });
      }

      // Render the page based on currentPage
      function renderPage(pageNum) {
        const canvas = document.getElementById("pdf-canvas");
        const context = canvas.getContext("2d");

        currentPdf.getPage(pageNum).then(page => {
          const scale = 1.5;
          const viewport = page.getViewport({ scale: scale });

          // Set canvas dimensions based on page size
          canvas.height = viewport.height;
          canvas.width = viewport.width;

          // Render the page
          const renderContext = {
            canvasContext: context,
            viewport: viewport
          };
          page.render(renderContext);

          // Update the page number text
          document.getElementById("page-num").textContent = `Page: ${pageNum} of ${totalPages}`;
        });
      }

      // Change the page (next or previous)
      function changePage(direction) {
        const newPage = currentPage + direction;
        if (newPage >= 1 && newPage <= totalPages) {
          currentPage = newPage;
          renderPage(currentPage);
        }
      }

      fetchRepoContents();
    </script>
  </body>
</html>
