<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Pages PDF Viewer</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.15.349/pdf.min.js"></script> <!-- PDF.js -->
  </head>
  <body>
    <header>
      <h1>GitHub Pages PDF Viewer</h1>
      <p>Automatically display PDFs and directories from GitHub repo</p>
      <p><a href="https://github.com/itsplawan/ACCA">View Project on GitHub</a></p>
    </header>

    <section>
      <h2>PDFs Available:</h2>
      <ul id="file-list">Loading PDFs...</ul>
      
      <h2>PDF Viewer:</h2>
      <div id="pdf-viewer" style="width:100%; height:600px;">
        <canvas id="pdf-canvas"></canvas> <!-- Canvas for rendering PDF -->
      </div>
    </section>

    <footer>
      <p>This project is maintained by <a href="https://github.com/itsplawan">itsplawan</a></p>
    </footer>

    <script>
      const repoOwner = "itsplawan";
      const repoName = "ACCA";
      const pdfFolder = "pdfs"; // Folder where PDFs are stored

      async function fetchRepoContents() {
        const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${pdfFolder}`;
        const response = await fetch(apiUrl);
        const data = await response.json();
        const fileList = document.getElementById("file-list");

        fileList.innerHTML = "";
        data.forEach(item => {
          if (item.type === "file" && item.name.endsWith(".pdf")) {
            const listItem = document.createElement("li");
            const link = document.createElement("a");
            link.href = "#";
            link.textContent = item.name;
            link.onclick = () => openPdf(item.download_url);
            listItem.appendChild(link);
            fileList.appendChild(listItem);
          }
        });
      }

      // Function to open and render PDF in PDF.js
      function openPdf(url) {
        const canvas = document.getElementById("pdf-canvas");
        const context = canvas.getContext("2d");

        pdfjsLib.getDocument(url).promise.then(pdf => {
          console.log('PDF loaded');
          
          // Get the first page
          pdf.getPage(1).then(page => {
            console.log('Page loaded');
            
            const scale = 1.5;
            const viewport = page.getViewport({ scale: scale });

            canvas.height = viewport.height;
            canvas.width = viewport.width;

            // Render the page
            const renderContext = {
              canvasContext: context,
              viewport: viewport
            };
            page.render(renderContext);
          });
        }).catch(error => {
          console.error('Error loading PDF:', error);
        });
      }

      fetchRepoContents();
    </script>
  </body>
</html>
